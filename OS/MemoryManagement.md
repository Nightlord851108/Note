# Memory Management

## Difference between Paging and segmentation
|             |       **Paging**            | **Segmentation**
|-------------|-----------------------------|--------
|Basic        | fixed-sized block           | variable-sized block
|Fragmentation| may lead to internal fragmentation | may lead to external fragmentation
|Address      | The user specified address is divided by CPU into a **page number** and **offset**. | The user specifies each address by a **segment number** and the **offset (Segment limit)**.
|Size         | The hardware decide page size | The segment size specified by user.
|Table        | Page table that contains base address of each page. | Segmentation table contains segment number and offset (segment length).
|Memory Used  | Paging requires more memory overhead to maintain the translation structures | Segmentation requires just two registers per segment: one to maintain the base of the segment and the other to maintain the extent of the segment.
| Entry       | Only one entry  | Requires two entries

## category
* ![Paging](#Paging)
* ![Segmentation](#Segmentation)
* ![Demand Paging](#Demand-Paging)

## Paging
refs: https://www.geeksforgeeks.org/operating-system-paging/

Paging is a memory management scheme which eliminates the need of physical memory.

Paging permit allows the physical address of a process to be non-continuous.

* Logical Address/Virtual Address (represented in bits): An address generated by the CPU.

* Logical Address Space/Virtual Address Space(represented in words/bytes): The set of all logical addresses generated by a program.

* Physical Address (represented in bits): An address actually available on memory unit.

* Physical Address Space (represented in words or bytes): The set of all physical addresses corresponding to the logical addresses

The mapping from virtual to physical address is done by the memory management unit (MMU) which is a hardware device and this mapping is known as paging technique.

* The Physical Address Space is conceptually divided into a number of fixed-size blocks, called frames.
* The Logical address Space is also split into fixed-size blocks, called pages.
* Page Size = Frame Size

### Example
Let us consider an example:

* Physical Address = 12 bits, then Physical Address Space = 4 K words
* Logical Address = 13 bits, then Logical Address Space = 8 K words
* Page size = frame size = 1 K words (assumption)

![paging example](https://cdncontribute.geeksforgeeks.org/wp-content/uploads/paging.jpg)

### Hardware Implementation of page table
Page table can be done by using dedicated registers, but the usage of register for the page table is satisfactory only if page table is small.

If page table contain large number of entries then we can use TLB.

#### TLB(translation look-aside buffer)
* a special, small, fast look up hardware cache.
* The TLB is associative, high speed memory.
* Each entry in TLB consists of two parts: a tag and a value.
* When this memory is used, then an item is compared with all tags simultaneously.If the item is found, then corresponding value is returned.

![TLB image](https://cdncontribute.geeksforgeeks.org/wp-content/uploads/paging-2.jpg)

Main memory access time = m

If page table are kept in main memory,

Effective access time = m(for page table) + m(for particular page in page table)

Let TLB access time = c,

TLB hit ratio = x, TLB miss ratio = (1-x), then,

Effective access time = hit ratio * (c + m) + miss ratio * (c + m + m)


## Segmentation

* No simple relationship between logical addresses and physical addresses

* Segment Table: stores the information about all such segments.

### Segment Table
Segment Table maps **two dimensional Logical address** into **one dimensional Physical address**.

Each table entry has:
* **Base address**: contains the starting physical address where the segments reside in memory.
* Limit: specifies the length of the segment.

![logical view of segmentation](https://www.geeksforgeeks.org/wp-content/uploads/gq/2016/02/segmentation.png)

![Segmentation image](https://www.geeksforgeeks.org/wp-content/uploads/gq/2016/02/Translation.png)
Address generated by the CPU is divided into:
* Segment number (s): Number of bits required to represent the segment.
* Segment offset (d): Number of bits required to represent the size of the segment.

### Advantage
* No internal fragmentation.
* Segment Table consumes less space in comparison to Page table in paging.

### Disadvantage
Segmentation cause **External fragmentation**. As processes are loaded and removed from the memory, the free memory space is broken into little pieces

## Demand(segmented) Paging
The combination of segmentation and paging, to get the benefit of both scheme.

In demand-paging, the segments is no longer a continuous space, instead, it's divided into several fixed size pages.

In general, the pages are smaller than segments, to avoid external fragmentation.

There are four tables in demand paging:
1. Job table: For system to record the processing jobs.

2. SMT (segment map table): Every job has an SMT to list the detail of all segments.

3. PMT (page map table): Every segments has a PMT to record the detail of all pages.

4. MMT (memory map table): System serves one MMT to monitor memory allocation.

### Page fault
A page fault (sometimes called #PF, PF or hard fault) is a type of exception raised by computer hardware when a running program accesses a memory page that is not currently mapped by the memory management unit (MMU) into the virtual address space of a process.

### Steps
![Demand paging image](https://cdncontribute.geeksforgeeks.org/wp-content/uploads/VirtualDiagram-1.png)

1. **CPU generates an interrupt indicating memory access fault**:
If CPU try to refer a page that is currently not available in the main memory, it generates an interrupt indicating memory access fault.

2. **OS block the interrupted process**: The OS puts the interrupted process in a blocking state. For the execution to proceed the OS must bring the required page into the memory.

3. **OS search for the required page**: The OS will search for the required page in the logical address space.

4. **Move the required page to physical address space**: The required page will be brought from logical address space to physical address space. The page replacement algorithms are used for the decision making of replacing the page in physical address space.

5. **Update page table**: The page table will updated accordingly.

6. **CPU continues the execution**: The signal will be sent to the CPU to continue the program execution and it will place the process back into ready state.

Whenever a page fault occurs these steps are followed by the operating system and the required page is brought into memory.

### Advantage
* More processes may be maintained in the main memory
* A process larger than the main memory can be executed
* It allows greater multiprogramming levels by using less of the available (primary) memory for each process.

### Page Fault Service Time

The time taken to service the page fault, includes the time taken to perform all the above six steps.
```
Let Main memory access time is: m
Page fault service time is: s
Page fault rate is : p
Then, Effective memory access time = (p*s) + (1-p)*m
```
